<div class="dashboard-container">
  <div class="column">
    <div class="welcome-banner">
      <h2>Financial Intelligence Dashboard</h2>
      <p>Your AI agents are analyzing markets and optimizing your financial education 24/7</p>
      <div class="stats-row">
        <div class="stat">
          <span class="stat-number">{{ activeAgents() }}</span>
          <span class="stat-label">Active Agents</span>
        </div>
        <div class="stat">
          <span class="stat-number">{{ overallProgress() }}%</span>
          <span class="stat-label">Progress</span>
        </div>
        <div class="stat">
          <span class="stat-number">{{ completedModules() }}</span>
          <span class="stat-label">Completed</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h4>Live Agent Activity</h4>
        <span class="last-updated">Last update: {{ formatUpdateTime() }}</span>
      </div>
      
      @for (agent of agents(); track agent.name) {
        <div class="agent-card">
          <div class="agent-header">
            <h5>{{ agent.name }}</h5>
            <span class="status" [class]="getStatusClass(agent.status)">
              {{ agent.status }}
            </span>
          </div>
          <p class="task">{{ agent.task }}</p>
          
          @if (agent.decision) {
            <div class="decision-box decision">
              <p><strong>DECISION:</strong> {{ agent.decision }}</p>
            </div>
          }
          
          @if (agent.prediction) {
            <div class="decision-box prediction">
              <p><strong>PREDICTION:</strong> {{ agent.prediction }}</p>
            </div>
          }
        </div>
      }
      
      @if (isLoading()) {
        <div class="loading-indicator">
          <span>Syncing with agents...</span>
        </div>
      }
    </div>
  </div>

  <div class="column">
    <div class="card">
      <div class="card-header">
        <h4>AI Planning & Learning Path</h4>
      </div>
      
      @if (planningInsights().length > 0) {
        @for (insight of planningInsights(); track $index) {
          <div class="prediction-item">
            <div class="prediction-icon">
              @switch ($index) {
                @case (0) { üéØ }
                @case (1) { üß† }
                @case (2) { üìö }
                @case (3) { ‚è∞ }
                @default { üí° }
              }
            </div>
            <div class="prediction-content">
              <p><strong>{{ insight }}</strong></p>
              <span class="confidence">AI Optimized</span>
            </div>
          </div>
        }
      } @else {
        <div class="prediction-item">
          <div class="prediction-icon">‚è≥</div>
          <div class="prediction-content">
            <p><strong>Loading your personalized learning plan...</strong></p>
            <span class="confidence">Analyzing assessments</span>
          </div>
        </div>
      }
    </div>

    <div class="card">
      <div class="card-header">
        <h4>Financial Learning Journey</h4>
        
        <!-- Current module tracking indicator -->
        @if (currentModuleInfo()) {
          <div class="current-module-indicator">
            <span class="current-label">Currently Learning:</span>
            <span class="current-module">{{ getCurrentModuleDisplay() }}</span>
            @if (currentModuleInfo()?.isActive) {
              <span class="module-step">Module {{ currentModuleNumber() }}</span>
            }
          </div>
        }
      </div>
      
      @for (module of learningModules(); track module.name) {
        <div class="learning-item" 
             [class.current-learning]="currentModuleName() === module.name && isUserLearning()">
          <div class="module-header">
            <span class="module-name">
              {{ module.name }}
              @if (currentModuleName() === module.name && isUserLearning()) {
                <span class="current-badge">CURRENT</span>
              }
            </span>
            <span class="module-status">
              {{ getModuleStatusIcon(module.status) }}
              @switch (module.status) {
                @case ('completed') { Complete }
                @case ('in-progress') { In Progress }
                @case ('upcoming') { Coming Next }
              }
            </span>
          </div>
          
          <div class="progress-container">
            <div class="progress-bar-container">
              <div 
                class="progress-bar" 
                [class.completed]="module.status === 'completed'"
                [class.current]="currentModuleName() === module.name"
                [style.width]="getProgressBarWidth(module.progress)">
              </div>
            </div>
            <span class="progress-text">{{ module.progress }}%</span>
          </div>
          
          <!-- Enhanced module actions with current module context -->
          @if (module.status === 'upcoming') {
            <div class="module-actions">
              <button 
                class="btn-start" 
                (click)="startLearningModule(module.name)"
                [disabled]="isLoading()">
                Start Module
              </button>
            </div>
          }
          
          @if (module.status === 'in-progress') {
            <div class="module-actions">
              <button 
                class="btn-continue" 
                (click)="saveProgress(module.name, 75)"
                [disabled]="isLoading()">
                Save Progress
              </button>
              <button 
                class="btn-complete" 
                (click)="completeModule(module.name)"
                [disabled]="isLoading()">
                Complete
              </button>
              
              <!-- Show current step info if this is the active module -->
              @if (currentModuleName() === module.name && isUserLearning()) {
                <div class="current-step-info">
                  <span class="step-indicator">Step {{ currentModuleInfo()?.stepNumber || 1 }}</span>
                </div>
              }
            </div>
          }
        </div>
      }
      
      <div class="learning-actions">
        <button 
          class="btn-primary" 
          (click)="continuelearning()"
          [disabled]="isLoading()">
          @if (isLoading()) {
            Syncing...
          } @else if (isUserLearning()) {
            Continue {{ currentModuleName() }} ‚Üí
          } @else {
            Start Learning ‚Üí
          }
        </button>
        
        <button 
          class="btn-secondary" 
          (click)="testUserHistory()"
          [disabled]="isLoading()">
          Test Agent Integration
        </button>
        
        <button 
          class="btn-secondary" 
          (click)="practiceTrading()"
          [disabled]="isLoading()">
          Practice Trading
        </button>
        
        <button 
          class="btn-secondary" 
          (click)="viewAllProgress()"
          [disabled]="isLoading()">
          View All Progress
        </button>
      </div>
    </div>
  </div>
</div>