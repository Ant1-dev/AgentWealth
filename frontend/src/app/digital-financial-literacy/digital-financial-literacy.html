<div class="trading-sandbox-container">
  <div class="info-panel">
    <div class="panel-section">
      <h3>Search Stocks</h3>
      <div class="search-bar">
        <input type="text" [(ngModel)]="searchTerm" (input)="searchStocks()" placeholder="e.g., AAPL or Apple" />
      </div>
      <ul class="search-results" *ngIf="searchResults().length > 0">
        <li *ngFor="let result of searchResults()" (click)="selectStock(result.symbol)">
          <span class="symbol">{{ result.symbol }}</span>
          <span class="name">{{ result.name }}</span>
        </li>
      </ul>
    </div>

    <ng-container *ngIf="selectedStock() as stock">
      <div class="panel-section stock-details">
        <h2>{{ stock.name }} ({{ stock.symbol }})</h2>
        <div class="price" [class.positive]="stock.change > 0" [class.negative]="stock.change < 0">
          ${{ stock.price.toFixed(2) }}
          <span>{{ stock.change.toFixed(2) }} ({{ stock.changePercent.toFixed(2) }}%)</span>
        </div>
        <div class="details-grid">
          <div><span>High</span><span>${{ stock.dayHigh.toFixed(2) }}</span></div>
          <div><span>Low</span><span>${{ stock.dayLow.toFixed(2) }}</span></div>
          <div><span>Volume</span><span>{{ (stock.volume / 1000000).toFixed(2) }}M</span></div>
          <div><span>Market Cap</span><span>${{ (stock.marketCap / 1000000000).toFixed(2) }}B</span></div>
        </div>
      </div>

      <div class="panel-section trading-controls">
        <h3>Trade {{ stock.symbol }}</h3>
        <div class="trade-box">
          <label for="buy-qty">Buy</label>
          <input id="buy-qty" type="number" [(ngModel)]="buyQuantity" min="1" placeholder="Quantity" />
          <button (click)="buyStock()" [disabled]="!buyQuantity || buyQuantity <= 0">Buy</button>
          <div class="trade-cost" *ngIf="buyQuantity">
            Cost: ${{ (buyQuantity * stock.price).toFixed(2) }}
          </div>
        </div>
        <div class="trade-box">
          <label for="sell-qty">Sell</label>
          <input id="sell-qty" type="number" [(ngModel)]="sellQuantity" min="1" placeholder="Quantity" />
          <button (click)="sellStock()" [disabled]="!sellQuantity || sellQuantity <= 0">Sell</button>
          <div class="trade-cost" *ngIf="sellQuantity">
            Value: ${{ (sellQuantity * stock.price).toFixed(2) }}
          </div>
        </div>
      </div>
    </ng-container>

    <div *ngIf="!selectedStock()" class="panel-section placeholder">
      <p>Search for a stock to get started.</p>
    </div>
  </div>

  <div class="chart-panel">
    <div class="chart-header">
      <h3>{{ selectedStock()?.name || 'Stock Chart' }}</h3>
      <div class="chart-range">
        <button (click)="updateChartRange('1M')" [class.active]="chartRange() === '1M'">1M</button>
        <button (click)="updateChartRange('6M')" [class.active]="chartRange() === '6M'">6M</button>
        <button (click)="updateChartRange('1Y')" [class.active]="chartRange() === '1Y'">1Y</button>
      </div>
    </div>
    <div class="chart-container">
      <canvas id="stockChart"></canvas>
    </div>
  </div>

  <div class="portfolio-panel">
    <h2>My Portfolio</h2>
    <div class="portfolio-summary">
      <div class="summary-item">
        <span class="label">Portfolio Value</span>
        <span class="value">${{ portfolioValue().toFixed(2) }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Cash Balance</span>
        <span class="value">${{ cashBalance().toFixed(2) }}</span>
      </div>
    </div>
    <div class="holdings">
      <h3>Your Holdings</h3>
      <ul>
        <li *ngFor="let holding of portfolio()">
          <div class="holding-info">
            <span class="symbol">{{ holding.symbol }}</span>
            <span class="quantity">{{ holding.quantity }} Shares</span>
          </div>
          <div class="holding-value">
            <span class="value">${{ (holding.quantity * (mockQuotes[holding.symbol].price || 0)).toFixed(2) }}</span>
            <span class="avg-price">Avg: ${{ holding.averagePrice.toFixed(2) }}</span>
          </div>
        </li>
      </ul>
      <p *ngIf="portfolio().length === 0" class="no-holdings">You do not own any stocks yet.</p>
    </div>
  </div>
</div>